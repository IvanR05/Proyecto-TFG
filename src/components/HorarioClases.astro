<div class="guardias-table">
    <table>
      <thead>
        <tr>
          <th>15:30-16:25</th>
          <th>16:25-17:20</th>
          <th>17:20-18:15</th>
          <th>18:15-18:35</th>
          <th>18:35-19:30</th>
          <th>19:30-20:25</th>
          <th>20:25-21:20</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <div class="time-column">
              <div class="guard-shift disponible">Guardia disponible - Aula 203</div>
              <div class="guard-shift asignada">Guardia asignada - Lab 1</div>
            </div>
          </td>
          <td>
            <div class="time-column">
              <div class="guard-shift disponible">Guardia disponible - Aula 105</div>
            </div>
          </td>
          <td>
            <div class="time-column">
              <div class="guard-shift asignada">Guardia asignada - Aula 110</div>
            </div>
          </td>
          <td>
            <div class="recreo">RECREO</div>
          </td>
          <td>
            <div class="time-column">
              <div class="guard-shift disponible">Guardia disponible - Aula 215</div>
            </div>
          </td>
          <td>
            <div class="time-column">
              <div class="guard-shift no-disponible">Guardia no disponible - Aula 305</div>
            </div>
          </td>
          <td>
            <div class="time-column">
              <div class="guard-shift disponible">Guardia disponible - Aula 201</div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <script>
        function updateTimeline() {
          console.log("heeeloo")
          const now = new Date();
            now.setHours(19, 30, 0, 0);  // Set to 19:30 for testing
          const currentHour = now.getHours();
          const currentMinute = now.getMinutes();
          const currentTimeInMinutes = currentHour * 60 + currentMinute;
      
          // Extract time slots from thead
          const timeSlots = Array.from(document.querySelectorAll('.guardias-table thead th')).map(th => {
              const [start, end] = th.textContent?.split('-') || [];
              return { start, end };
          });
      
          // Convert time to minutes
          function timeToMinutes(time) {
              const [hour, minute] = time.split(':').map(Number);
              return hour * 60 + minute;
          }
      
          // Find current slot and position within it
          let currentSlotIndex = -1;
          let positionInSlot = 0;
      
          timeSlots.forEach((slot, index) => {
              const startMinutes = timeToMinutes(slot.start);
              const endMinutes = timeToMinutes(slot.end);
              if (currentTimeInMinutes >= startMinutes && currentTimeInMinutes < endMinutes) {
                  currentSlotIndex = index;
                  const slotDuration = endMinutes - startMinutes;
                  const elapsedInSlot = currentTimeInMinutes - startMinutes;
                  positionInSlot = (elapsedInSlot / slotDuration) * 100; // Percentage within the slot
              }
          });
      
          console.log("yes reachign here 2")
          // Position the line if within a slot
          if (currentSlotIndex !== -1) {
              console.log("yes reachign here")
              // Get the th element for the current slot
              const thElement = document.querySelectorAll('.guardias-table thead th')[currentSlotIndex];
              const columnLeft = (thElement as HTMLElement).offsetLeft;    // Left position of the column
              const columnWidth = (thElement as HTMLElement).offsetWidth;  // Width of the column
              const lineLeft = columnLeft + (positionInSlot / 100) * columnWidth; // Position within the column
      
              // Create or update the timeline element
              let timeline = document.getElementById('current-time-line');
              if (!timeline) {
                  console.log("aaaa")
                  timeline = document.createElement('div');
                  timeline.id = 'current-time-line';
                  document.querySelector('.guardias-table')?.appendChild(timeline);
              }
              timeline.style.left = `${lineLeft}px`;  // Set horizontal position
          }
      }
      
      // Initial update
      updateTimeline();
      
      // Update every minute
      setInterval(updateTimeline, 60000);
      </script>
</div>

<style>
  .guardias-table {
    overflow-x: auto;
    width: 100%;
    border: 1px solid #ddd;
    background-color: white;
    position: relative;
    min-height: 200px;  /* Ensures the container has height */
    margin-bottom: 20px;
}

  .guardias-table table {
    width: 100%;
    border-collapse: collapse;
  }

  .guardias-table thead th {
    position: sticky; /* Fija el encabezado en la parte superior */
    top: 0;
    background: #f5f5f5; /* Fondo para que no se trasluzca el contenido */
    padding: 1rem;
    text-align: center;
    border-right: 1px solid #ddd;
    z-index: 10; /* Asegura que esté sobre el contenido */
    min-width: 140px; /* Ancho mínimo para las columnas */
  }

  .guardias-table tbody td {
    padding: 1rem;
    border-right: 1px solid #ddd;
    vertical-align: top;
    max-height: 300px; /* Limita la altura de las celdas */
    overflow-y: auto; /* Permite scroll vertical en las celdas */
  }

  .time-column {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .guard-shift {
    padding: 0.5rem;
    border-radius: 4px;
  }

  .guard-shift.disponible { background: #e6f7ff; }
  .guard-shift.asignada { background: #f6ffed; }
  .guard-shift.no-disponible { background: #fff1f0; }

  .recreo {
    background: #fff3e0;
    padding: 1rem;
    text-align: center;
  }

  #current-time-line {
    position: absolute;
    top: 0;              /* Start at the top of .guardias-table */
    width: 2px;          /* Thin vertical line */
    height: 100%;        /* Span the full height of the table */
    background: red;
    z-index: 100;        /* Ensure it’s above other content */
}
</style>

