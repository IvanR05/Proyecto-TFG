---
import Layout from "../layouts/Layout.astro";
import { supabase } from "../lib/supabase.js";

const { data: usuarios, error } = await supabase
  .from("usuarios")
  .select("id, nombre, correo, tipo, aceptado, created_at")
  .order("created_at", { ascending: true });
---

<Layout page_title="Gestión de Usuarios">
  <main class="content-wrapper">
    <h1 class="page-title">🏢 Gestión de Usuarios</h1>

    <!-- Controles de filtrado -->
    <div class="controls">
      <div class="filters">
        <button class="filter-btn active" data-filter="all">🌐 Todos</button>
        <button class="filter-btn" data-filter="active">✅ Activos</button>
        <button class="filter-btn" data-filter="inactive">⛔ Inactivos</button>
      </div>

      <div class="search-box">
        <input
          type="text"
          id="search-input"
          placeholder="🔍 Buscar por nombre..."
          class="search-input"
        />
      </div>
    </div>

    <!-- Tabla de usuarios -->
    {error ? (
      <div class="error-message">
        ⚠️ Error al cargar usuarios: {error.message}
      </div>
    ) : (
      <div class="table-wrapper">
        <table class="users-table">
          <thead>
            <tr>
              <th>👤 Nombre</th>
              <th>📧 Correo</th>
              <th>🎓 Tipo</th>
              <th>📊 Estado</th>
              <th>⚙️ Acciones</th>
            </tr>
          </thead>
          <tbody id="users-list">
            {usuarios.map((usuario) => (
              <tr
                class="user-row"
                data-status={usuario.aceptado ? "active" : "inactive"}
                data-name={(usuario.nombre || "").toLowerCase()}
                data-id={usuario.id}
              >
                <td>{usuario.nombre || "Sin nombre"}</td>
                <td>{usuario.correo}</td>
                <td class="user-type">{usuario.tipo || "N/A"}</td>
                <td>
                  <span
                    class={`status-pill ${usuario.aceptado ? "active" : "inactive"}`}
                  >
                    {usuario.aceptado ? "Activo" : "Inactivo"}
                  </span>
                </td>
                <td class="actions">
                  <button class="edit-btn" data-id="${usuario.id}">
                    ✏️
                  </button>
                  <button class="delete-btn" data-id="${usuario.id}">
                    🗑️
                  </button>
                </td>
              </tr>
            ))}
            <tr class="no-results">
              <td colspan="5">😞 No se encontraron usuarios</td>
            </tr>
          </tbody>
        </table>
      </div>
    )}
  </main>

  <script is:inline>
    // Código JavaScript anterior se mantiene igual
  </script>

  <style>
    /* Ajustes de estilo para el layout oscuro */
    .content-wrapper {
      width: 100%;
      max-width: 380px;
      padding: 1rem;
      box-sizing: border-box;
    }

    .page-title {
      color: #fff;
      text-align: center;
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .filters {
      display: flex;
      gap: 0.5rem;
      overflow-x: auto;
      padding-bottom: 0.5rem;
    }

    .filter-btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 20px;
      background: #333;
      color: #fff;
      font-size: 0.9rem;
      white-space: nowrap;
    }

    .filter-btn.active {
      background: #555;
      font-weight: bold;
    }

    .search-input {
      width: 100%;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      border: 1px solid #444;
      background: #222;
      color: #fff;
    }

    .users-table {
      width: 100%;
      font-size: 0.9rem;
      border-collapse: collapse;
    }

    .users-table th,
    .users-table td {
      padding: 0.75rem;
      border-bottom: 1px solid #333;
    }

    .users-table th {
      background: #222;
      position: sticky;
      top: 0;
    }

    .status-pill {
      padding: 0.25rem 0.75rem;
      border-radius: 15px;
      font-size: 0.8rem;
    }

    .status-pill.active {
      background: #27ae60;
      color: white;
    }

    .status-pill.inactive {
      background: #e74c3c;
      color: white;
    }

    .edit-btn, .delete-btn {
      padding: 0.25rem 0.5rem;
      border: none;
      border-radius: 4px;
      margin: 0 2px;
    }

    .edit-btn {
      background: #f39c12;
      color: #000;
    }

    .delete-btn {
      background: #c0392b;
      color: #fff;
    }

    .no-results {
      text-align: center;
      color: #888;
      padding: 1rem;
    }

    .error-message {
      background: #2c0909;
      color: #ff5555;
      padding: 1rem;
      border-radius: 6px;
      text-align: center;
    }

    @media (max-width: 380px) {
      .users-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
      
      .filters {
        scrollbar-width: thin;
        scrollbar-color: #444 #222;
      }
      
      .filters::-webkit-scrollbar {
        height: 6px;
      }
      
      .filters::-webkit-scrollbar-track {
        background: #222;
      }
      
      .filters::-webkit-scrollbar-thumb {
        background: #444;
        border-radius: 3px;
      }
    }
  </style>
</Layout>